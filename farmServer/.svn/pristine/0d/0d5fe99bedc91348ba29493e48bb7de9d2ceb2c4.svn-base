package com.fngame.farm.service;

import com.fngame.farm.mapper.UserMapper;
import com.fngame.farm.model.User;
import com.fngame.farm.model.UserExample;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;
import java.util.List;

@Service
public class loginService {
    @Resource
    UserMapper userMapper;


    public boolean addUser(User user, Integer type) {
        //根据type 判断是否注册过
        User user1 = null;
        switch (type) {
            case 1:
                user1 = this.getUser(user.getUsername(), user.getPassword(), type);
                break;
            case 2:
                user1 = this.getUser(user.getTel(), user.getPassword(), type);
                break;
            case 3:
                user1 = this.getUser(user.getOpenid(), null, type);
        }
        int i = 0;
        if (user1 == null) {
            try {
                i = userMapper.insertSelective(user);
            } catch (Exception e) {
                return false;
            }
        }
        return i > 0;
    }

    public User getUser(String username, String password, Integer type) {
        UserExample userExample = new UserExample();
        UserExample.Criteria criteria = userExample.createCriteria();


        switch (type) {
            case 1://账户密码登录
                criteria.andUsernameEqualTo(username);
                criteria.andPasswordEqualTo(password);
                break;
            case 2://电话号码登录
                criteria.andTelEqualTo(username);
                criteria.andPasswordEqualTo(password);
                break;
            case 3://QQ微信登录
                criteria.andOpenidEqualTo(username);
                break;
        }

        List<User> users = userMapper.selectByExample(userExample);
        if (users.size() > 0) {
            return users.get(0);
        }

        return null;
    }
}
